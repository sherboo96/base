<div class="p-4 mx-auto max-w-full">
  <app-loading></app-loading>
  <div
    *ngIf="isLoading && !courses.length"
    class="fixed inset-0 flex justify-center items-center bg-gray-100 bg-opacity-70 z-50"
    id="custom-loader"
  >
    <div class="spinner-container">
      <div class="spinner"></div>
      <p class="mt-3 text-accent font-medium text-sm">
        {{ 'course.loadingCourses' | translate }}
      </p>
    </div>
  </div>
  <div class="mb-4 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-textDark mb-0.5 flex items-center gap-2">
        <i class="fas fa-book text-accent text-lg"></i>
        <span>{{ 'course.title' | translate }}</span>
      </h1>
      <p class="text-xs text-gray-600">
        {{ 'course.subtitle' | translate }}
      </p>
    </div>
  </div>
  <!-- Search and Filters Section -->
  <div class="mb-3 bg-white shadow-md rounded-lg overflow-hidden border border-gray-100">
    <div class="bg-accentDark px-3 py-1.5">
      <div class="flex items-center gap-1.5">
        <i class="fas fa-filter text-white text-xs"></i>
        <h2 class="text-xs font-semibold text-white">
          {{ isPublicView ? ('course.searchAndFilter' | translate) : ('course.filter' | translate) }}
        </h2>
      </div>
    </div>
    <div class="p-3 bg-gray-50">
      <!-- Search Bar -->
      <div class="mb-3">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()"
          [placeholder]="'course.searchPlaceholder' | translate"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent"
        />
      </div>

      <!-- Filters Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
        <!-- Location Filter (Public View) -->
        <div *ngIf="isPublicView">
          <label class="block text-xs font-semibold text-gray-700 mb-1">{{ 'course.location' | translate }}</label>
          <select
            [(ngModel)]="filterLocationId"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-accent focus:border-accent"
          >
            <option [value]="null">{{ 'course.allLocations' | translate }}</option>
            <option *ngFor="let location of locations" [value]="location.id">{{ location.name }}</option>
          </select>
        </div>

        <!-- Course Tab Filter (Management View) -->
        <div *ngIf="!isPublicView">
          <label class="block text-xs font-semibold text-gray-700 mb-1">
            <i class="fas fa-folder mr-1.5 text-accent text-xs"></i>{{ 'course.courseTab' | translate }}
          </label>
          <select
            [(ngModel)]="filterCourseTabId"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-accent focus:border-accent"
          >
            <option [value]="null">{{ 'course.allCourseTabs' | translate }}</option>
            <option *ngFor="let tab of courseTabs" [value]="tab.id">{{ tab.name }}</option>
          </select>
        </div>

        <!-- Status Filter (Management View) -->
        <div *ngIf="!isPublicView">
          <label class="block text-xs font-semibold text-gray-700 mb-1">
            <i class="fas fa-info-circle mr-1.5 text-accent text-xs"></i>{{ 'course.status' | translate }}
          </label>
          <select
            [(ngModel)]="filterStatus"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-accent focus:border-accent"
          >
            <option value="all">{{ 'course.allStatuses' | translate }}</option>
            <option [value]="'Draft'">{{ 'course.statusDraft' | translate }}</option>
            <option [value]="'Published'">{{ 'course.statusPublished' | translate }}</option>
            <option [value]="'RegistrationClosed'">{{ 'course.statusRegistrationClosed' | translate }}</option>
            <option [value]="'Active'">{{ 'course.statusActive' | translate }}</option>
            <option [value]="'Completed'">{{ 'course.statusCompleted' | translate }}</option>
            <option [value]="'Canceled'">{{ 'course.statusCanceled' | translate }}</option>
            <option [value]="'Archived'">{{ 'course.statusArchived' | translate }}</option>
          </select>
        </div>

        <!-- Start Date From -->
        <div>
          <label class="block text-xs font-semibold text-gray-700 mb-1">{{ 'course.startDateFrom' | translate }}</label>
          <input
            type="date"
            [(ngModel)]="filterStartDateFrom"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-accent focus:border-accent"
          />
        </div>

        <!-- Start Date To -->
        <div>
          <label class="block text-xs font-semibold text-gray-700 mb-1">{{ 'course.startDateTo' | translate }}</label>
          <input
            type="date"
            [(ngModel)]="filterStartDateTo"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-accent focus:border-accent"
          />
        </div>

        <!-- End Date From -->
        <div>
          <label class="block text-xs font-semibold text-gray-700 mb-1">{{ 'course.endDateFrom' | translate }}</label>
          <input
            type="date"
            [(ngModel)]="filterEndDateFrom"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-accent focus:border-accent"
          />
        </div>

        <!-- End Date To -->
        <div>
          <label class="block text-xs font-semibold text-gray-700 mb-1">{{ 'course.endDateTo' | translate }}</label>
          <input
            type="date"
            [(ngModel)]="filterEndDateTo"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-accent focus:border-accent"
          />
        </div>
      </div>

      <!-- Filter Actions -->
      <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-200">
        <button
          (click)="applyFilters()"
          class="px-4 py-2 bg-accent hover:bg-accentDark text-white rounded-lg text-sm font-medium transition-colors"
        >
          <i class="fas fa-filter mr-2"></i>
          {{ 'course.applyFilters' | translate }}
        </button>
        <button
          *ngIf="hasActiveFilters()"
          (click)="clearFilters()"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition-colors"
        >
          <i class="fas fa-times mr-2"></i>
          {{ 'course.clearFilters' | translate }}
        </button>
      </div>
    </div>
  </div>


  <!-- Cards View -->
  <div class="mb-4 flex justify-between items-center">
    <div class="flex items-center gap-2">
      <h3 class="text-sm font-semibold text-gray-800">
        {{ 'course.title' | translate }}
      </h3>
      <span
        *ngIf="totalItems > 0"
        class="px-2 py-0.5 bg-gray-200 text-gray-700 text-xs font-medium rounded-full"
      >
        {{ totalItems }}
        {{
          totalItems === 1
            ? ('course.course' | translate)
            : ('course.courses' | translate)
        }}
      </span>
    </div>
    <button
      *ngIf="!isPublicView"
      (click)="addNewCourse()"
      class="bg-accent hover:bg-accentDark text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors duration-200 text-sm font-medium shadow-md hover:shadow-lg"
    >
      <i class="fas fa-plus-circle"></i>
      <span>{{ 'course.addCourse' | translate }}</span>
    </button>
  </div>

  <div
    *ngIf="courses.length === 0 && !isLoading"
    class="empty-state py-12 flex flex-col items-center justify-center bg-white rounded-lg shadow-md border border-gray-100"
  >
    <div class="bg-gray-50 rounded-full p-4 mb-3 shadow-md">
      <i class="fas fa-book text-4xl text-gray-300"></i>
    </div>
    <h3 class="text-xl font-bold text-textDark mb-1">
      <span *ngIf="hasActiveFilters()">{{
        'course.noCoursesMatching' | translate
      }}</span>
      <span *ngIf="!hasActiveFilters()">{{
        'course.noCoursesFound' | translate
      }}</span>
    </h3>
    <p class="text-xs text-gray-600 text-center max-w-md mb-4">
      <span *ngIf="hasActiveFilters()">{{
        'course.noCoursesMatchingDescription' | translate
      }}</span>
      <span *ngIf="!hasActiveFilters()">{{
        'course.noCoursesAvailable' | translate
      }}</span>
    </p>
    <button
      *ngIf="hasActiveFilters()"
      (click)="clearFilters()"
      class="px-4 py-2 bg-accentDark hover:bg-accentDarker text-white rounded-lg transition-all duration-200 shadow-md hover:shadow-lg font-semibold text-xs flex items-center gap-1.5 font-poppins"
    >
      <i class="fas fa-times-circle text-xs"></i>
      <span>{{ 'course.clearFilters' | translate }}</span>
    </button>
  </div>

  <!-- Course Cards Grid -->
  <div *ngIf="courses.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-6">
    <div
      *ngFor="let course of courses"
      [class.cursor-pointer]="!isPublicView"
      [class.cursor-default]="isPublicView"
      (click)="!isPublicView && viewCourseDetails(course)"
      class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 overflow-hidden group flex flex-col"
    >
      <!-- Card Header with Location Logo and Status -->
      <div class="relative bg-gradient-to-br from-accent via-accentDark to-accent h-24 overflow-hidden">
        <!-- Status Badge -->
        <div class="absolute top-3 right-3 z-10 flex flex-col gap-1.5 items-end">
          <span [class]="getStatusClass(course.status)" class="px-3 py-1 text-xs font-bold rounded-full shadow-lg backdrop-blur-sm border border-white/30">
            {{ getStatusText(course.status) }}
          </span>
          <!-- Enrollment Badge -->
          <span 
            *ngIf="course.isEnrolled && isPublicView" 
            [class]="getEnrollmentStatusBadgeClass(course.enrollmentStatus)"
            class="px-3 py-1 text-xs font-bold rounded-full shadow-lg backdrop-blur-sm border border-white/30"
          >
            {{ 'course.enrollmentStatus' | translate }}: {{ getEnrollmentStatusText(course.enrollmentStatus) }}
          </span>
        </div>
        <!-- Location Logo and Name - Logo on left, text beside it -->
        <div class="h-full flex items-center gap-3 px-4 py-3 pt-4">
          <!-- Location Logo -->
          <div class="flex-shrink-0">
            <div class="h-14 w-14 rounded-xl bg-white/25 backdrop-blur-sm flex items-center justify-center p-2 shadow-lg border border-white/30">
              <img 
                *ngIf="course.location?.logo"
                [src]="getLocationLogoUrl(course.location.logo)" 
                [alt]="course.location?.name || 'Location'"
                class="h-full w-full object-contain"
                (error)="$event.target.style.display='none'"
              />
              <i *ngIf="!course.location?.logo || !course.location?.logo" class="fas fa-map-marker-alt text-white text-2xl"></i>
            </div>
          </div>
          <!-- Location Name -->
          <div class="flex-1 min-w-0">
            <p *ngIf="course.location?.name" class="text-white text-sm font-bold truncate drop-shadow-lg mb-0.5">
              {{ course.location.name }}
            </p>
            <p *ngIf="!course.location?.name" class="text-white text-sm font-bold truncate drop-shadow-lg mb-0.5 opacity-90">
              {{ 'course.location' | translate }}
            </p>
            <p class="text-white/80 text-xs truncate">
              {{ course.courseTab?.name || '-' }}
            </p>
          </div>
        </div>
      </div>

      <!-- Card Body -->
      <div class="p-5 flex-1 flex flex-col">
        <div class="mb-3">
          <h3 class="text-xl font-bold text-textDark mb-2 line-clamp-2 group-hover:text-accent transition-colors leading-tight">
            {{ course.courseTitle }}
          </h3>
          <div class="flex items-center gap-2">
            <span class="px-2.5 py-1 bg-gradient-to-r from-blue-50 to-blue-100 text-blue-700 rounded-md font-semibold text-xs border border-blue-200">
              {{ course.code }}
            </span>
          </div>
        </div>

        <div class="space-y-2.5 mt-auto">
          <div class="flex items-center gap-2.5 text-sm">
            <div class="w-8 h-8 rounded-lg bg-accent/10 flex items-center justify-center flex-shrink-0">
              <i class="fas fa-calendar-alt text-accent text-xs"></i>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-xs text-gray-500 font-medium">{{ 'course.startDateTime' | translate }}</p>
              <p class="text-sm text-gray-800 font-semibold truncate">{{ course.startDateTime ? formatDateTime(course.startDateTime) : '-' }}</p>
            </div>
          </div>
          <div class="flex items-center gap-2.5 text-sm">
            <div class="w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center flex-shrink-0">
              <i class="fas fa-users text-green-600 text-xs"></i>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-xs text-gray-500 font-medium">{{ 'course.availableSeats' | translate }}</p>
              <p class="text-sm text-gray-800 font-semibold">{{ course.availableSeats }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Card Footer -->
      <div class="px-5 py-4 bg-gradient-to-r from-gray-50 to-gray-100 border-t border-gray-200">
        <!-- Public View: View and Enroll Buttons -->
        <div *ngIf="isPublicView" class="flex items-center gap-3">
          <button
            (click)="viewCourseDetails(course); $event.stopPropagation()"
            class="flex-1 px-4 py-2.5 bg-white border-2 border-accent text-accent hover:bg-accent hover:text-white rounded-lg text-sm font-semibold flex items-center justify-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg"
          >
            <i class="fas fa-eye"></i>
            <span>{{ 'course.view' | translate }}</span>
          </button>
          <button
            *ngIf="!course.isEnrolled"
            (click)="enrollInCourse(course); $event.stopPropagation()"
            class="flex-1 px-4 py-2.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105"
          >
            <i class="fas fa-user-plus"></i>
            <span>{{ 'course.enroll' | translate }}</span>
          </button>
          <button
            *ngIf="course.isEnrolled"
            disabled
            class="flex-1 px-4 py-2.5 bg-gray-400 text-white rounded-lg text-sm font-bold flex items-center justify-center gap-2 cursor-not-allowed opacity-75"
          >
            <i class="fas fa-check-circle"></i>
            <span>{{ 'course.enrolled' | translate }}</span>
          </button>
        </div>
        <!-- Management View: Actions and View Details -->
        <div *ngIf="!isPublicView" class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-2">
            <button
              (click)="editCourse(course); $event.stopPropagation()"
              class="p-2 rounded-lg bg-white hover:bg-accent/10 text-accent hover:text-accentDark transition-all duration-200 shadow-sm hover:shadow-md"
              [title]="'course.edit' | translate"
            >
              <i class="fas fa-edit text-sm"></i>
            </button>
            <button
              (click)="deleteCourse(course); $event.stopPropagation()"
              class="p-2 rounded-lg bg-white hover:bg-red-50 text-red-500 hover:text-red-700 transition-all duration-200 shadow-sm hover:shadow-md"
              [title]="'course.delete' | translate"
            >
              <i class="fas fa-trash text-sm"></i>
            </button>
            <button
              *ngIf="course.status === CourseStatus.Draft"
              (click)="publishCourse(course); $event.stopPropagation()"
              class="p-2 rounded-lg bg-white hover:bg-green-50 text-green-600 hover:text-green-700 transition-all duration-200 shadow-sm hover:shadow-md"
              [title]="'course.publish' | translate"
            >
              <i class="fas fa-check-circle text-sm"></i>
            </button>
          </div>
          <button
            (click)="viewCourseDetails(course); $event.stopPropagation()"
            class="px-4 py-2 bg-accent hover:bg-accentDark text-white rounded-lg text-sm font-semibold flex items-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105"
          >
            <span>{{ 'course.viewDetails' | translate }}</span>
            <i class="fas fa-arrow-right text-xs"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div
    *ngIf="courses.length > 0"
    class="flex flex-col sm:flex-row items-center justify-between bg-white p-5 rounded-lg shadow-md border border-gray-200"
  >
    <div class="text-sm font-medium text-textDark mb-2 sm:mb-0">
      <i class="fas fa-info-circle mr-2 text-accent"></i>
      {{
        'course.showing'
          | translate
            : {
                from: (currentPage - 1) * pageSize + 1,
                to: Math.min(currentPage * pageSize, totalItems),
                total: totalItems
              }
      }}
    </div>
    <div class="flex items-center space-x-3">
      <select
        [(ngModel)]="pageSize"
        (change)="onPageSizeChange()"
        class="text-sm border-2 border-gray-300 rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent bg-white shadow-sm font-medium"
      >
        <option [value]="10">10 {{ 'course.perPage' | translate }}</option>
        <option [value]="20">20 {{ 'course.perPage' | translate }}</option>
        <option [value]="50">50 {{ 'course.perPage' | translate }}</option>
        <option [value]="100">100 {{ 'course.perPage' | translate }}</option>
      </select>
      <div class="flex space-x-1">
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === 1"
          (click)="goToPage(1)"
          [title]="'common.firstPage' | translate"
        >
          <i class="fas fa-angle-double-left"></i>
        </button>
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === 1"
          (click)="goToPage(currentPage - 1)"
          [title]="'common.previousPage' | translate"
        >
          <i class="fas fa-chevron-left"></i>
        </button>
        <div class="flex space-x-1">
          <button
            *ngFor="let page of getPageNumbers()"
            (click)="goToPage(page)"
            class="px-4 py-1.5 rounded-lg border-2 text-sm min-w-[40px] font-medium transition-all duration-200 shadow-sm hover:shadow-md"
            [ngClass]="{
              'bg-accentDark text-white border-accent shadow-md':
                currentPage === page,
              'border-gray-300 hover:bg-gray-100 hover:border-gray-400':
                currentPage !== page
            }"
          >
            {{ page }}
          </button>
        </div>
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(currentPage + 1)"
          [title]="'common.nextPage' | translate"
        >
          <i class="fas fa-chevron-right"></i>
        </button>
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(totalPages)"
          [title]="'common.lastPage' | translate"
        >
          <i class="fas fa-angle-double-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

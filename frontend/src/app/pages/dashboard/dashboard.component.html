<div class="p-4 mx-auto max-w-full">
    <app-loading></app-loading>

    <!-- Loading State -->
    <div *ngIf="isLoading && !statistics"
        class="fixed inset-0 flex justify-center items-center bg-gray-100 bg-opacity-70 z-50">
        <div class="spinner-container">
            <div class="spinner"></div>
            <p class="mt-3 text-accent font-medium text-sm font-poppins">{{'dashboard.loading'|translate}}</p>
        </div>
    </div>

    <!-- Header -->
    <div class="mb-4 flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold text-textDark mb-0.5 flex items-center gap-2 font-poppins">
                <i class="material-icons text-accent text-lg">dashboard</i>
                <span>{{'dashboard.title'|translate}}</span>
            </h1>
            <p class="text-xs text-gray-600 font-poppins">
                {{'dashboard.subtitle'|translate}}
            </p>
        </div>
        <button (click)="refreshData()" [disabled]="isLoading"
            class="px-4 py-2 bg-accent hover:bg-accentDark text-white rounded-lg flex items-center gap-2 transition-colors duration-200 shadow-md hover:shadow-lg font-semibold text-xs disabled:opacity-50 disabled:cursor-not-allowed font-poppins"
            [title]="'dashboard.refresh'|translate">
            <i class="material-icons text-sm" [class.animate-spin]="isLoading">refresh</i>
            <span>{{'dashboard.refresh'|translate}}</span>
        </button>
    </div>

    <!-- User Statistics Section -->
    <div *ngIf="userStatistics" class="mb-8">
        <h2 class="text-lg font-bold text-gray-800 mb-4 font-poppins">{{'dashboard.myStatistics'|translate}}</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <!-- Rank Card -->
            <div
                class="bg-white shadow-md rounded-lg p-5 border-l-4 border-yellow-500 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                            {{'dashboard.rank'|translate}}</p>
                        <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">#{{userStatistics.rank}}</p>
                    </div>
                    <div class="p-3 bg-yellow-100 rounded-full">
                        <i class="material-icons text-yellow-600 text-2xl">emoji_events</i>
                    </div>
                </div>
            </div>

            <!-- Approved Courses Card -->
            <div
                class="bg-white shadow-md rounded-lg p-5 border-l-4 border-blue-500 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                            {{'dashboard.approvedCourses'|translate}}</p>
                        <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">
                            {{userStatistics.approvedCoursesCount}}</p>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-full">
                        <i class="material-icons text-blue-600 text-2xl">check_circle</i>
                    </div>
                </div>
            </div>

            <!-- Attended Courses Card -->
            <div
                class="bg-white shadow-md rounded-lg p-5 border-l-4 border-green-500 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                            {{'dashboard.attendedCourses'|translate}}</p>
                        <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">
                            {{userStatistics.attendedCoursesCount}}</p>
                    </div>
                    <div class="p-3 bg-green-100 rounded-full">
                        <i class="material-icons text-green-600 text-2xl">school</i>
                    </div>
                </div>
            </div>

            <!-- Attended Hours Card -->
            <div
                class="bg-white shadow-md rounded-lg p-5 border-l-4 border-purple-500 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                            {{'dashboard.attendedHours'|translate}}</p>
                        <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{userStatistics.attendedHours}}
                        </p>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-full">
                        <i class="material-icons text-purple-600 text-2xl">schedule</i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lists of Courses -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Approved Courses List -->
            <div class="bg-white shadow-md rounded-lg p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 font-poppins">
                    <i class="material-icons text-blue-500">playlist_add_check</i>
                    <span>{{'dashboard.approvedCoursesList'|translate}}</span>
                </h3>
                <div class="space-y-3 max-h-64 overflow-y-auto">
                    <div *ngFor="let course of userStatistics.approvedCourses"
                        class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <span class="text-sm font-medium text-gray-900 font-poppins">{{course.courseName}}</span>
                        <span
                            class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full font-poppins">{{'dashboard.approved'|translate}}</span>
                    </div>
                    <div *ngIf="userStatistics.approvedCourses.length === 0"
                        class="text-sm text-gray-500 text-center py-4 font-poppins">
                        {{'dashboard.noData'|translate}}
                    </div>
                </div>
            </div>

            <!-- Attended Courses List -->
            <div class="bg-white shadow-md rounded-lg p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 font-poppins">
                    <i class="material-icons text-green-500">history_edu</i>
                    <span>{{'dashboard.attendedCoursesList'|translate}}</span>
                </h3>
                <div class="space-y-3 max-h-64 overflow-y-auto">
                    <div *ngFor="let course of userStatistics.attendedCourses"
                        class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <span class="text-sm font-medium text-gray-900 font-poppins">{{course.courseName}}</span>
                        <span
                            class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-poppins">{{'dashboard.attended'|translate}}</span>
                    </div>
                    <div *ngIf="userStatistics.attendedCourses.length === 0"
                        class="text-sm text-gray-500 text-center py-4 font-poppins">
                        {{'dashboard.noData'|translate}}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div *ngIf="statistics" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
        <!-- Total Users Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-blue-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.totalUsers'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalUsers}}</p>
                </div>
                <div class="p-3 bg-blue-100 rounded-full">
                    <i class="material-icons text-blue-600 text-2xl">people</i>
                </div>
            </div>
            <div class="mt-4 flex items-center gap-4 text-xs">
                <div class="flex items-center gap-1">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    <span class="text-gray-600 font-poppins">{{'dashboard.active'|translate}}:
                        {{statistics.activeUsers}}</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                    <span class="text-gray-600 font-poppins">{{'dashboard.inactive'|translate}}:
                        {{statistics.inactiveUsers}}</span>
                </div>
            </div>
        </div>

        <!-- Locked Users Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-orange-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.lockedUsers'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.lockedUsers}}</p>
                </div>
                <div class="p-3 bg-orange-100 rounded-full">
                    <i class="material-icons text-orange-600 text-2xl">lock</i>
                </div>
            </div>
            <div class="mt-4">
                <p class="text-xs text-gray-500 font-poppins">{{'dashboard.usersWithTempPassword'|translate}}:
                    {{statistics.usersWithTemporaryPassword}}</p>
            </div>
        </div>

        <!-- Organizations Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-purple-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.organizations'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalOrganizations}}</p>
                </div>
                <div class="p-3 bg-purple-100 rounded-full">
                    <i class="material-icons text-purple-600 text-2xl">business</i>
                </div>
            </div>
        </div>

        <!-- Departments Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-indigo-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.departments'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalDepartments}}</p>
                </div>
                <div class="p-3 bg-indigo-100 rounded-full">
                    <i class="material-icons text-indigo-600 text-2xl">account_balance</i>
                </div>
            </div>
        </div>

        <!-- Roles Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-teal-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.roles'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalRoles}}</p>
                </div>
                <div class="p-3 bg-teal-100 rounded-full">
                    <i class="material-icons text-teal-600 text-2xl">supervisor_account</i>
                </div>
            </div>
        </div>

        <!-- Segments Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-pink-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.segments'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalSegments}}</p>
                </div>
                <div class="p-3 bg-pink-100 rounded-full">
                    <i class="material-icons text-pink-600 text-2xl">pie_chart</i>
                </div>
            </div>
        </div>

        <!-- Locations Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-green-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.locations'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalLocations}}</p>
                </div>
                <div class="p-3 bg-green-100 rounded-full">
                    <i class="material-icons text-green-600 text-2xl">location_on</i>
                </div>
            </div>
        </div>

        <!-- Job Titles Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-yellow-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.jobTitles'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalJobTitles}}</p>
                </div>
                <div class="p-3 bg-yellow-100 rounded-full">
                    <i class="material-icons text-yellow-600 text-2xl">badge</i>
                </div>
            </div>
        </div>

        <!-- Positions Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-cyan-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.positions'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalPositions}}</p>
                </div>
                <div class="p-3 bg-cyan-100 rounded-full">
                    <i class="material-icons text-cyan-600 text-2xl">work</i>
                </div>
            </div>
        </div>

        <!-- Instructors Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-red-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.instructors'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalInstructors}}</p>
                </div>
                <div class="p-3 bg-red-100 rounded-full">
                    <i class="material-icons text-red-600 text-2xl">school</i>
                </div>
            </div>
        </div>

        <!-- Institutions Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-amber-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.institutions'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalInstitutions}}</p>
                </div>
                <div class="p-3 bg-amber-100 rounded-full">
                    <i class="material-icons text-amber-600 text-2xl">account_balance</i>
                </div>
            </div>
        </div>

        <!-- Adoption Users Card -->
        <div
            class="bg-white shadow-md rounded-lg p-5 border-l-4 border-emerald-500 hover:shadow-lg transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-600 uppercase tracking-wider font-poppins">
                        {{'dashboard.adoptionUsers'|translate}}</p>
                    <p class="text-2xl font-bold text-gray-900 mt-2 font-poppins">{{statistics.totalAdoptionUsers}}</p>
                </div>
                <div class="p-3 bg-emerald-100 rounded-full">
                    <i class="material-icons text-emerald-600 text-2xl">person_add</i>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div *ngIf="statistics" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Users by Login Method -->
        <div class="bg-white shadow-md rounded-lg p-6 border border-gray-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 font-poppins">
                <i class="material-icons text-accent">login</i>
                <span>{{'dashboard.usersByLoginMethod'|translate}}</span>
            </h3>
            <div class="space-y-3">
                <div *ngFor="let method of getLoginMethodKeys()"
                    class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full" [ngClass]="getLoginMethodColor(method)"></div>
                        <span
                            class="text-sm font-medium text-gray-900 font-poppins">{{getLoginMethodLabel(method)}}</span>
                    </div>
                    <span class="text-lg font-bold text-gray-900 font-poppins">{{statistics.usersByLoginMethod[method]
                        || 0}}</span>
                </div>
                <div *ngIf="getLoginMethodKeys().length === 0"
                    class="text-sm text-gray-500 text-center py-4 font-poppins">
                    {{'dashboard.noData'|translate}}
                </div>
            </div>
        </div>

        <!-- Users by Organization -->
        <div class="bg-white shadow-md rounded-lg p-6 border border-gray-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 font-poppins">
                <i class="material-icons text-accent">business</i>
                <span>{{'dashboard.usersByOrganization'|translate}}</span>
            </h3>
            <div class="space-y-3 max-h-64 overflow-y-auto">
                <div *ngFor="let org of getOrganizationKeys()"
                    class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <div class="flex items-center gap-3 flex-1 min-w-0">
                        <i class="material-icons text-accent text-sm">domain</i>
                        <span class="text-sm font-medium text-gray-900 truncate font-poppins">{{org}}</span>
                    </div>
                    <span
                        class="text-lg font-bold text-gray-900 ml-2 font-poppins">{{statistics.usersByOrganization[org]
                        || 0}}</span>
                </div>
                <div *ngIf="getOrganizationKeys().length === 0"
                    class="text-sm text-gray-500 text-center py-4 font-poppins">
                    {{'dashboard.noData'|translate}}
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div *ngIf="statistics" class="bg-white shadow-md rounded-lg p-6 border border-gray-100">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2 font-poppins">
            <i class="material-icons text-accent">flash_on</i>
            <span>{{'dashboard.quickActions'|translate}}</span>
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            <a routerLink="/management/users"
                class="flex flex-col items-center p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors cursor-pointer group">
                <i
                    class="material-icons text-blue-600 text-3xl mb-2 group-hover:scale-110 transition-transform">people</i>
                <span
                    class="text-xs font-medium text-gray-900 text-center font-poppins">{{'dashboard.manageUsers'|translate}}</span>
            </a>
            <a routerLink="/management/organization"
                class="flex flex-col items-center p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors cursor-pointer group">
                <i
                    class="material-icons text-purple-600 text-3xl mb-2 group-hover:scale-110 transition-transform">business</i>
                <span
                    class="text-xs font-medium text-gray-900 text-center font-poppins">{{'dashboard.manageOrganizations'|translate}}</span>
            </a>
            <a routerLink="/management/roles"
                class="flex flex-col items-center p-4 bg-teal-50 rounded-lg hover:bg-teal-100 transition-colors cursor-pointer group">
                <i
                    class="material-icons text-teal-600 text-3xl mb-2 group-hover:scale-110 transition-transform">supervisor_account</i>
                <span
                    class="text-xs font-medium text-gray-900 text-center font-poppins">{{'dashboard.manageRoles'|translate}}</span>
            </a>
            <a routerLink="/management/segment"
                class="flex flex-col items-center p-4 bg-pink-50 rounded-lg hover:bg-pink-100 transition-colors cursor-pointer group">
                <i
                    class="material-icons text-pink-600 text-3xl mb-2 group-hover:scale-110 transition-transform">pie_chart</i>
                <span
                    class="text-xs font-medium text-gray-900 text-center font-poppins">{{'dashboard.manageSegments'|translate}}</span>
            </a>
            <a routerLink="/management/location"
                class="flex flex-col items-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors cursor-pointer group">
                <i
                    class="material-icons text-green-600 text-3xl mb-2 group-hover:scale-110 transition-transform">location_on</i>
                <span
                    class="text-xs font-medium text-gray-900 text-center font-poppins">{{'dashboard.manageLocations'|translate}}</span>
            </a>
            <a routerLink="/management/adoption-user"
                class="flex flex-col items-center p-4 bg-emerald-50 rounded-lg hover:bg-emerald-100 transition-colors cursor-pointer group">
                <i
                    class="material-icons text-emerald-600 text-3xl mb-2 group-hover:scale-110 transition-transform">person_add</i>
                <span
                    class="text-xs font-medium text-gray-900 text-center font-poppins">{{'dashboard.manageAdoptionUsers'|translate}}</span>
            </a>
        </div>
    </div>
</div>
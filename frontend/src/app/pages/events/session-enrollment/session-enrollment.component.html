<div class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 py-8 px-4 relative" [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'">
  <!-- Language Switcher -->
  <div class="fixed top-4 z-50" [ngClass]="currentLang === 'ar' ? 'left-4' : 'right-4'">
    <app-language-switcher></app-language-switcher>
  </div>
  
  <div class="max-w-6xl mx-auto">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="min-h-[60vh] flex items-center justify-center">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-accent mb-4"></div>
        <p class="text-gray-600 font-poppins">{{ 'sessionEnrollment.loading' | translate }}</p>
      </div>
    </div>

    <!-- Error Message / Session Not Found -->
    <div
      *ngIf="errorMessage && !isLoading && !sessionInfo"
      class="min-h-[60vh] flex items-center justify-center"
      [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
    >
      <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-8 md:p-12 text-center w-full max-w-2xl mx-auto">
        <div class="mb-6 flex justify-center">
          <div class="w-24 h-24 bg-red-100 rounded-full flex items-center justify-center">
            <i class="fas fa-exclamation-triangle text-red-500 text-4xl"></i>
          </div>
        </div>
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 font-poppins">
          {{ 'sessionEnrollment.sessionNotFound' | translate }}
        </h2>
        <p class="text-lg text-gray-600 mb-8 font-poppins leading-relaxed">
          {{ errorMessage }}
        </p>
        <div class="flex justify-center gap-4">
          <button
            type="button"
            (click)="loadSessionInfo()"
            class="px-6 py-3 bg-accent text-white rounded-xl hover:bg-accent-dark transition-all duration-300 font-poppins font-semibold shadow-lg hover:shadow-xl"
          >
            {{ 'sessionEnrollment.retry' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Success Message with QR Code -->
    <div
      *ngIf="isSuccess && !isLoading && !errorMessage && enrollmentResult"
      class="min-h-[60vh] flex items-center justify-center"
      [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
    >
      <div class="bg-white rounded-2xl shadow-2xl border border-gray-100 p-8 md:p-12 text-center w-full max-w-2xl mx-auto">
        <div class="mb-6 flex justify-center">
          <div class="relative">
            <div class="w-24 h-24 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg">
              <svg
                class="h-14 w-14 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                  d="M5 13l4 4L19 7"
                />
              </svg>
            </div>
            <div class="absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-4 border-white animate-pulse"></div>
          </div>
        </div>
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 font-poppins text-center">
          {{ 'sessionEnrollment.successTitle' | translate }}
        </h2>
        <p class="text-lg text-gray-600 mb-8 font-poppins text-center leading-relaxed">
          {{ 'sessionEnrollment.successMessage' | translate }}
        </p>

        <div class="flex justify-center gap-4">
          <button
            type="button"
            (click)="reloadPage()"
            class="px-8 py-3 bg-gradient-to-r from-accent to-accent-dark text-white rounded-xl hover:from-accent-dark hover:to-accent transition-all duration-300 font-poppins font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
          >
            {{ 'sessionEnrollment.enrollAnother' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Session Header -->
    <div *ngIf="sessionInfo && !isSuccess && !isLoading && !errorMessage" class="mb-8" [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'">
      <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
        <!-- Session Banner -->
        <div *ngIf="sessionInfo.banner" class="w-full overflow-hidden relative">
          <img
            [src]="getBannerUrl()"
            [alt]="sessionInfo.title"
            class="w-full h-auto object-cover"
            style="max-height: 400px;"
          />
        </div>

        <!-- Session Info -->
        <div class="p-6 md:p-8 lg:p-10">
          <!-- Title Section -->
          <div class="mb-6">
            <h1 
              class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-3 font-poppins leading-tight"
              [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
            >
              {{ getSessionTitle() }}
            </h1>
            <div *ngIf="sessionInfo.eventName" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent/10 to-accent-light/10 rounded-full border border-accent/20">
              <i class="fas fa-calendar-alt text-accent text-sm"></i>
              <span class="text-sm font-medium text-gray-700 font-poppins">
                {{ currentLang === 'ar' && sessionInfo.eventNameAr ? sessionInfo.eventNameAr : sessionInfo.eventName }}
              </span>
            </div>
          </div>

          <!-- Description -->
          <div *ngIf="getSessionDescription()" class="mb-8" [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'">
            <p class="text-gray-700 leading-relaxed font-poppins text-base md:text-lg">
              {{ getSessionDescription() }}
            </p>
          </div>

          <!-- Info Badges -->
          <div class="flex flex-wrap items-center gap-3">
            <!-- Date & Time Badge -->
            <div *ngIf="sessionInfo.dateTime" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-full">
              <i class="fas fa-calendar text-blue-600"></i>
              <div [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'">
                <span class="text-xs font-semibold text-blue-600 uppercase tracking-wide font-poppins mr-2">
                  {{ 'sessionEnrollment.dateTime' | translate }}:
                </span>
                <span class="text-sm font-semibold text-gray-800 font-poppins">
                  {{ formatDate(sessionInfo.dateTime) }}
                </span>
              </div>
            </div>

            <!-- Seats Badge -->
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-full">
              <i class="fas fa-users text-green-600"></i>
              <div [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'">
                <span class="text-xs font-semibold text-green-600 uppercase tracking-wide font-poppins mr-2">
                  {{ 'sessionEnrollment.seats' | translate }}:
                </span>
                <span class="text-sm font-semibold text-gray-800 font-poppins">
                  {{ sessionInfo.totalSeats }}
                </span>
              </div>
            </div>

            <!-- Available Seats Badge -->
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-full">
              <i class="fas fa-user-check text-green-600"></i>
              <div [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'">
                <span class="text-xs font-semibold text-green-600 uppercase tracking-wide font-poppins mr-2">
                  {{ 'sessionEnrollment.availableSeats' | translate }}:
                </span>
                <span class="text-sm font-semibold text-gray-800 font-poppins">
                  {{ sessionInfo.availableSeats }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enrollment Form -->
    <div *ngIf="!isSuccess && !isLoading && !errorMessage && sessionInfo" class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden" [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'">
      <!-- Form Header -->
      <div class="bg-gradient-to-r from-accent/10 via-accent-light/10 to-accent/10 p-6 md:p-8 border-b border-gray-200">
        <div class="flex items-center gap-4">
          <div class="w-14 h-14 bg-gradient-to-br from-accent to-accent-dark rounded-xl flex items-center justify-center shadow-md">
            <i class="fas fa-user-plus text-white text-xl"></i>
          </div>
          <div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-1 font-poppins">
              {{ 'sessionEnrollment.enrollFor' | translate }}
            </h2>
            <p class="text-sm text-gray-600 font-poppins">
              {{ getSessionTitle() }}
            </p>
          </div>
        </div>
      </div>

      <!-- Form Content -->
      <div class="p-6 md:p-8 lg:p-10">

      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Name -->
          <div class="space-y-2">
            <label
              for="name"
              class="block text-sm font-medium text-gray-700 font-poppins"
              [ngClass]="currentLang === 'ar' ? 'text-right' : 'text-left'"
            >
              {{ 'sessionEnrollment.name' | translate }} <span class="text-red-500">*</span>
            </label>
            <input
              id="name"
              type="text"
              formControlName="name"
              [placeholder]="'sessionEnrollment.namePlaceholder' | translate"
              [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
              [style.text-align]="currentLang === 'ar' ? 'right' : 'left'"
              class="form-control w-full border-2 border-gray-300 rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 font-poppins placeholder-gray-400 bg-white hover:border-gray-400"
              [class.border-red-500]="form.get('name')?.invalid && form.get('name')?.touched"
            />
            <div
              *ngIf="form.get('name')?.invalid && form.get('name')?.touched"
              class="flex items-start text-sm text-red-600 gap-1"
              [ngClass]="currentLang === 'ar' ? 'flex-row-reverse justify-end' : ''"
            >
              <i class="fas fa-exclamation-circle mt-0.5" [ngClass]="currentLang === 'ar' ? 'ml-1' : 'mr-1'"></i>
              <span>{{ 'common.thisFieldRequired' | translate }}</span>
            </div>
          </div>

          <!-- Name (Arabic) -->
          <div class="space-y-2">
            <label
              for="nameAr"
              class="block text-sm font-medium text-gray-700 font-poppins text-right"
            >
              {{ 'sessionEnrollment.nameAr' | translate }}
            </label>
            <input
              id="nameAr"
              type="text"
              formControlName="nameAr"
              [placeholder]="'sessionEnrollment.nameArPlaceholder' | translate"
              dir="rtl"
              style="text-align: right;"
              class="form-control w-full border-2 border-gray-300 rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 font-poppins placeholder-gray-400 bg-white hover:border-gray-400"
            />
          </div>

          <!-- Phone -->
          <div class="space-y-2">
            <label
              for="phone"
              class="block text-sm font-medium text-gray-700 font-poppins"
              [ngClass]="currentLang === 'ar' ? 'text-right' : 'text-left'"
            >
              {{ 'sessionEnrollment.phone' | translate }} <span class="text-red-500">*</span>
            </label>
            <input
              id="phone"
              type="tel"
              formControlName="phone"
              [placeholder]="'sessionEnrollment.phonePlaceholder' | translate"
              [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
              [style.text-align]="currentLang === 'ar' ? 'right' : 'left'"
              class="form-control w-full border-2 border-gray-300 rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 font-poppins placeholder-gray-400 bg-white hover:border-gray-400"
              [class.border-red-500]="form.get('phone')?.invalid && form.get('phone')?.touched"
            />
            <div
              *ngIf="form.get('phone')?.invalid && form.get('phone')?.touched"
              class="flex items-start text-sm text-red-600 gap-1"
              [ngClass]="currentLang === 'ar' ? 'flex-row-reverse justify-end' : ''"
            >
              <i class="fas fa-exclamation-circle mt-0.5" [ngClass]="currentLang === 'ar' ? 'ml-1' : 'mr-1'"></i>
              <span>{{ 'common.thisFieldRequired' | translate }}</span>
            </div>
          </div>

          <!-- Email -->
          <div class="space-y-2">
            <label
              for="email"
              class="block text-sm font-medium text-gray-700 font-poppins"
              [ngClass]="currentLang === 'ar' ? 'text-right' : 'text-left'"
            >
              {{ 'sessionEnrollment.email' | translate }} <span class="text-red-500">*</span>
            </label>
            <input
              id="email"
              type="email"
              formControlName="email"
              [placeholder]="'sessionEnrollment.emailPlaceholder' | translate"
              [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
              [style.text-align]="currentLang === 'ar' ? 'right' : 'left'"
              class="form-control w-full border-2 border-gray-300 rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 font-poppins placeholder-gray-400 bg-white hover:border-gray-400"
              [class.border-red-500]="form.get('email')?.invalid && form.get('email')?.touched"
            />
            <div
              *ngIf="form.get('email')?.invalid && form.get('email')?.touched"
              class="flex items-start text-sm text-red-600 gap-1"
              [ngClass]="currentLang === 'ar' ? 'flex-row-reverse justify-end' : ''"
            >
              <i class="fas fa-exclamation-circle mt-0.5" [ngClass]="currentLang === 'ar' ? 'ml-1' : 'mr-1'"></i>
              <span>{{ 'common.thisFieldRequired' | translate }}</span>
            </div>
          </div>

          <!-- Barcode/QR Code -->
          <div class="space-y-2">
            <div class="flex items-center gap-3" [ngClass]="currentLang === 'ar' ? 'flex-row-reverse justify-end' : ''">
              <label
                for="barcode"
                class="block text-sm font-medium text-gray-700 font-poppins"
                [ngClass]="currentLang === 'ar' ? 'text-right' : 'text-left'"
              >
                {{ 'sessionEnrollment.barcode' | translate }}
              </label>
              <button
                type="button"
                (click)="openBadgeHint()"
                class="text-xs text-accent hover:text-accent-dark transition-colors font-poppins font-medium underline decoration-dotted underline-offset-2"
                [title]="'sessionEnrollment.badgeHintButton' | translate"
              >
                {{ 'sessionEnrollment.badgeHintButton' | translate }}
              </button>
            </div>
            <input
              id="barcode"
              type="text"
              formControlName="barcode"
              [placeholder]="'sessionEnrollment.barcodePlaceholder' | translate"
              [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
              [style.text-align]="currentLang === 'ar' ? 'right' : 'left'"
              class="form-control w-full border-2 border-gray-300 rounded-lg py-2.5 px-4 text-sm focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 font-poppins placeholder-gray-400 font-mono"
              [class.border-red-500]="form.get('barcode')?.invalid && form.get('barcode')?.touched"
            />
            <div
              *ngIf="form.get('barcode')?.invalid && form.get('barcode')?.touched"
              class="flex items-start text-sm text-red-600 gap-1"
              [ngClass]="currentLang === 'ar' ? 'flex-row-reverse justify-end' : ''"
            >
              <i class="fas fa-exclamation-circle mt-0.5" [ngClass]="currentLang === 'ar' ? 'ml-1' : 'mr-1'"></i>
              <span>{{ 'common.thisFieldRequired' | translate }}</span>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              {{ 'sessionEnrollment.barcodeHint' | translate }}
            </p>
          </div>

          <!-- Event Organization -->
          <div class="space-y-2">
            <label
              for="eventOrganizationId"
              class="block text-sm font-medium text-gray-700 font-poppins"
              [ngClass]="currentLang === 'ar' ? 'text-right' : 'text-left'"
            >
              {{ 'sessionEnrollment.organization' | translate }} <span class="text-red-500">*</span>
            </label>
            <select
              id="eventOrganizationId"
              formControlName="eventOrganizationId"
              [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
              [style.text-align]="currentLang === 'ar' ? 'right' : 'left'"
              class="form-control w-full border-2 border-gray-300 rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 font-poppins bg-white hover:border-gray-400"
              [class.border-red-500]="form.get('eventOrganizationId')?.invalid && form.get('eventOrganizationId')?.touched"
            >
              <option [value]="null">{{ 'common.select' | translate }}...</option>
              <option *ngFor="let org of eventOrganizations" [value]="org.id">
                {{ currentLang === 'ar' && org.nameAr ? org.nameAr : org.name }}
              </option>
              <option value="other">{{ 'sessionEnrollment.otherOrganization' | translate }}</option>
            </select>
            <div
              *ngIf="form.get('eventOrganizationId')?.invalid && form.get('eventOrganizationId')?.touched"
              class="flex items-start text-sm text-red-600 gap-1"
              [ngClass]="currentLang === 'ar' ? 'flex-row-reverse justify-end' : ''"
            >
              <i class="fas fa-exclamation-circle mt-0.5" [ngClass]="currentLang === 'ar' ? 'ml-1' : 'mr-1'"></i>
              <span>{{ 'common.thisFieldRequired' | translate }}</span>
            </div>
          </div>

          <!-- Other Organization -->
          <div *ngIf="showOtherOrganization" class="space-y-2 md:col-span-2">
            <label
              for="otherOrganization"
              class="block text-sm font-medium text-gray-700 font-poppins"
              [ngClass]="currentLang === 'ar' ? 'text-right' : 'text-left'"
            >
              {{ 'sessionEnrollment.otherOrganizationName' | translate }} <span class="text-red-500">*</span>
            </label>
            <input
              id="otherOrganization"
              type="text"
              formControlName="otherOrganization"
              [placeholder]="'sessionEnrollment.otherOrganizationPlaceholder' | translate"
              [dir]="currentLang === 'ar' ? 'rtl' : 'ltr'"
              [style.text-align]="currentLang === 'ar' ? 'right' : 'left'"
              class="form-control w-full border-2 border-gray-300 rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 font-poppins placeholder-gray-400 bg-white hover:border-gray-400"
              [class.border-red-500]="form.get('otherOrganization')?.invalid && form.get('otherOrganization')?.touched"
            />
            <div
              *ngIf="form.get('otherOrganization')?.invalid && form.get('otherOrganization')?.touched"
              class="flex items-start text-sm text-red-600 gap-1"
              [ngClass]="currentLang === 'ar' ? 'flex-row-reverse justify-end' : ''"
            >
              <i class="fas fa-exclamation-circle mt-0.5" [ngClass]="currentLang === 'ar' ? 'ml-1' : 'mr-1'"></i>
              <span>{{ 'common.thisFieldRequired' | translate }}</span>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end pt-6 border-t border-gray-200 mt-8">
          <button
            type="submit"
            [disabled]="isSubmitting || form.invalid"
            class="px-10 py-4 bg-accent text-white rounded-xl hover:bg-accent-dark transition-all duration-300 font-poppins font-semibold shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transform hover:-translate-y-0.5 disabled:transform-none flex items-center gap-3"
          >
            <i *ngIf="!isSubmitting" class="fas fa-paper-plane"></i>
            <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
            <span *ngIf="!isSubmitting">{{ 'sessionEnrollment.submit' | translate }}</span>
            <span *ngIf="isSubmitting">{{ 'sessionEnrollment.submitting' | translate }}</span>
          </button>
        </div>
      </form>
      </div>
    </div>
  </div>
</div>


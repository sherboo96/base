<div class="p-4 mx-auto max-w-full">
  <app-loading></app-loading>
  <div
    *ngIf="isLoading && !items.length"
    class="fixed inset-0 flex justify-center items-center bg-gray-100 bg-opacity-70 z-50"
    id="custom-loader"
  >
    <div class="spinner-container">
      <div class="spinner"></div>
      <p class="mt-3 text-accent font-medium text-sm">
        {{ 'digitalLibrary.loadingItems' | translate }}
      </p>
    </div>
  </div>
  <div class="mb-4 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-textDark mb-0.5 flex items-center gap-2">
        <i class="fas fa-book text-accent text-lg"></i>
        <span>{{ 'digitalLibrary.title' | translate }}</span>
      </h1>
      <p class="text-xs text-gray-600">
        {{ 'digitalLibrary.subtitle' | translate }}
      </p>
    </div>
  </div>
  <!-- Search and Filters Section -->
  <div class="mb-3 bg-white shadow-md rounded-lg overflow-hidden border border-gray-100">
    <div class="bg-accentDark px-3 py-1.5">
      <div class="flex items-center gap-1.5">
        <i class="fas fa-filter text-white text-xs"></i>
        <h2 class="text-xs font-semibold text-white">
          {{ 'digitalLibrary.searchAndFilter' | translate }}
        </h2>
      </div>
    </div>
    <div class="p-3 bg-gray-50">
      <!-- Search Bar -->
      <div class="mb-3">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()"
          [placeholder]="'digitalLibrary.searchPlaceholder' | translate"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent"
        />
      </div>

      <!-- Filter Actions -->
      <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-200">
        <button
          (click)="onSearch()"
          class="px-4 py-2 bg-accent hover:bg-accentDark text-white rounded-lg text-sm font-medium transition-colors"
        >
          <i class="fas fa-filter mr-2"></i>
          {{ 'digitalLibrary.applyFilters' | translate }}
        </button>
        <button
          *ngIf="hasActiveFilters()"
          (click)="clearFilters()"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition-colors"
        >
          <i class="fas fa-times mr-2"></i>
          {{ 'digitalLibrary.clearFilters' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Items View -->
  <div class="mb-4 flex justify-between items-center">
    <div class="flex items-center gap-2">
      <h3 class="text-sm font-semibold text-gray-800">
        {{ 'digitalLibrary.title' | translate }}
      </h3>
      <span
        *ngIf="totalItems > 0"
        class="px-2 py-0.5 bg-gray-200 text-gray-700 text-xs font-medium rounded-full"
      >
        {{ totalItems }}
        {{
          totalItems === 1
            ? ('digitalLibrary.item' | translate)
            : ('digitalLibrary.items' | translate)
        }}
      </span>
    </div>
  </div>

  <div
    *ngIf="items.length === 0 && !isLoading"
    class="empty-state py-12 flex flex-col items-center justify-center bg-white rounded-lg shadow-md border border-gray-100"
  >
    <div class="bg-gray-50 rounded-full p-4 mb-3 shadow-md">
      <i class="fas fa-book text-4xl text-gray-300"></i>
    </div>
    <h3 class="text-xl font-bold text-textDark mb-1">
      <span *ngIf="hasActiveFilters()">{{
        'digitalLibrary.noItemsMatching' | translate
      }}</span>
      <span *ngIf="!hasActiveFilters()">{{
        'digitalLibrary.noItemsFound' | translate
      }}</span>
    </h3>
    <p class="text-xs text-gray-600 text-center max-w-md mb-4">
      <span *ngIf="hasActiveFilters()">{{
        'digitalLibrary.noItemsMatchingDescription' | translate
      }}</span>
      <span *ngIf="!hasActiveFilters()">{{
        'digitalLibrary.noItemsAvailable' | translate
      }}</span>
    </p>
    <button
      *ngIf="hasActiveFilters()"
      (click)="clearFilters()"
      class="px-4 py-2 bg-accentDark hover:bg-accentDarker text-white rounded-lg transition-all duration-200 shadow-md hover:shadow-lg font-semibold text-xs flex items-center gap-1.5 font-poppins"
    >
      <i class="fas fa-times-circle text-xs"></i>
      <span>{{ 'digitalLibrary.clearFilters' | translate }}</span>
    </button>
  </div>

  <!-- Items Cards Grid -->
  <div *ngIf="items.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-6">
    <div
      *ngFor="let item of items"
      class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 overflow-hidden group flex flex-col cursor-pointer"
      (click)="viewItemDetails(item)"
    >
      <!-- Card Header with Poster -->
      <div class="relative bg-gradient-to-br from-accent via-accentDark to-accent h-48 overflow-hidden">
        <img 
          *ngIf="item.posterPath" 
          [src]="getPosterUrl(item.posterPath)" 
          [alt]="item.name"
          class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
          (error)="$event.target.style.display='none'"
        />
        <div *ngIf="!item.posterPath" class="w-full h-full flex items-center justify-center text-white">
          <i class="fas fa-book text-6xl opacity-50"></i>
        </div>
        <!-- Files Badge -->
        <div class="absolute top-3 right-3 z-10">
          <span class="px-3 py-1 bg-white/90 backdrop-blur-sm text-accent rounded-full text-xs font-bold shadow-lg border border-white/30">
            {{ (item.files?.length ?? 0) }} {{ 'digitalLibrary.files' | translate }}
          </span>
        </div>
      </div>

      <!-- Card Body -->
      <div class="p-5 flex-1 flex flex-col">
        <div class="mb-3">
          <h3 class="text-xl font-bold text-textDark mb-2 line-clamp-2 group-hover:text-accent transition-colors leading-tight">
            {{ item.name }}
          </h3>
          <p class="text-gray-600 text-sm mb-4 line-clamp-3">
            {{ item.description || ('digitalLibrary.noDescription' | translate) }}
          </p>
        </div>
      </div>

      <!-- Card Footer -->
      <div class="px-5 py-4 bg-gradient-to-r from-gray-50 to-gray-100 border-t border-gray-200">
        <button
          class="w-full px-4 py-2.5 bg-white border-2 border-accent text-accent hover:bg-accent hover:text-white rounded-lg text-sm font-semibold flex items-center justify-center gap-2 transition-all duration-200 shadow-md hover:shadow-lg"
        >
          <i class="fas fa-eye"></i>
          <span>{{ 'digitalLibrary.view' | translate }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div
    *ngIf="items.length > 0"
    class="flex flex-col sm:flex-row items-center justify-between bg-white p-5 rounded-lg shadow-md border border-gray-200"
  >
    <div class="text-sm font-medium text-textDark mb-2 sm:mb-0">
      <i class="fas fa-info-circle mr-2 text-accent"></i>
      {{
        'digitalLibrary.showing'
          | translate
            : {
                from: (currentPage - 1) * pageSize + 1,
                to: Math.min(currentPage * pageSize, totalItems),
                total: totalItems
              }
      }}
    </div>
    <div class="flex items-center space-x-3">
      <select
        [(ngModel)]="pageSize"
        (change)="onPageSizeChange()"
        class="text-sm border-2 border-gray-300 rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent bg-white shadow-sm font-medium"
      >
        <option [value]="10">10 {{ 'digitalLibrary.perPage' | translate }}</option>
        <option [value]="20">20 {{ 'digitalLibrary.perPage' | translate }}</option>
        <option [value]="50">50 {{ 'digitalLibrary.perPage' | translate }}</option>
        <option [value]="100">100 {{ 'digitalLibrary.perPage' | translate }}</option>
      </select>
      <div class="flex space-x-1">
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === 1"
          (click)="goToPage(1)"
          [title]="'common.firstPage' | translate"
        >
          <i class="fas fa-angle-double-left"></i>
        </button>
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === 1"
          (click)="goToPage(currentPage - 1)"
          [title]="'common.previousPage' | translate"
        >
          <i class="fas fa-chevron-left"></i>
        </button>
        <div class="flex space-x-1">
          <button
            *ngFor="let page of getPageNumbers()"
            (click)="goToPage(page)"
            class="px-4 py-1.5 rounded-lg border-2 text-sm min-w-[40px] font-medium transition-all duration-200 shadow-sm hover:shadow-md"
            [ngClass]="{
              'bg-accentDark text-white border-accent shadow-md':
                currentPage === page,
              'border-gray-300 hover:bg-gray-100 hover:border-gray-400':
                currentPage !== page
            }"
          >
            {{ page }}
          </button>
        </div>
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(currentPage + 1)"
          [title]="'common.nextPage' | translate"
        >
          <i class="fas fa-chevron-right"></i>
        </button>
        <button
          class="px-3 py-1.5 rounded-lg border-2 border-gray-300 text-sm font-medium hover:bg-gray-100 hover:border-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(totalPages)"
          [title]="'common.lastPage' | translate"
        >
          <i class="fas fa-angle-double-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>
